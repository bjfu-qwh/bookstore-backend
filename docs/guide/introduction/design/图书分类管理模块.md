**# 图书分类管理模块 设计文档

图书分类管理从属图书管理，是图书信息不可缺少的部分。分类管理设计目标如下：

- 为图书添加分类：能为图书添加**多级分类**。
- 分类修改：任何有分类的图书，应当支持分类中任意一级的修改和删除。尤其是**中间级的修改不应该破坏树结构**。
- 分类查询：按分类中的任意一级可以快速查询相关图书。

## 数据表设计

分类表主体**初步设计方案**如下：

| 字段名   | 字段类型    | 标识符    | 说明                             |
|:------|:--------|:-------|:-------------------------------|
| 分类编号  | varchar | id     | 唯一标识每个分类的ID,分类一般是工作人员手动添加      |
| 分类名称  | varchar | name   | 分类名称主要用于展示                     |
| 父分类编号 | Long    | parent | 通过父分类实现递归查询，若parent=''表示其为顶层分类 |

将主体表命名为**t_category_info**。

## 分类管理功能设计

分类管理子系统的功能如下所示：

- 添加分类：可以创建一个新分类。创建分类时，既可以快速添加子代，也可以**添加现有分类作为其父分类**。
- 为图书添加分类：在创建图书时应支持分类添加。
- 分类修改：支持分类的修改删除等。

[当当网](https://www.dangdang.com/)的图书分类编号形如**newcate1_2_2**，分析发现应当是工作人员人工进行输入。<br>
对分类表的设计，有如下考虑：

- 必须存储**图书最底层的分类**。例如"计算机/编程语言/java"的分类树，应当存储**java**。
- 理清分类删除逻辑：**若删除某级分类，应当连带删除其所有子分类**。
- 图书应该支持**任意一级分类的搜索**。

因此加上表t_category_book记录**图书id-分类id**关系表。

| 字段名        | 字段类型   | 标识符         | 说明             |
|:-----------|:-------|:------------|:---------------|
| id         | Long   | id          | 数据表主键          |
| 图书编号       | String | book_id     | 图书编号ID，加索引     |
| 分类编号       | String | category_id | 分类ID，加索引       |
| 分类对应的父分类编号 | String | parent_id   | 方便批量删除，若为''表示无 |

有了两张表后，可以设计分类相关的操作流程：

- 添加分类：一次支持添加一个分类，前端指定**t_category_info**的所有信息后传给后端处理。
- 为图书指定分类：给定一个分类ID，图书应该**视为拥有该分类及其所有父分类**。换言之， 输入分类ID应该查出其到根分类的完整路径。
- 删除**分类本身**：由于分类通过**t_category_book**会与图书绑定，在**分类有相关图书关联时不应该支持删除操作**
  ；否则，**删除一级分类应当删除其所有子分类。**
- 修改**分类本身**：**分类名和父节点支持修改**。
- 图书分类操作：图书分类修改**不影响分类本身**，但会**影响图书分类树**，因而**一次只支持单个分类数据的修改和删除**。

